<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>L I G H T R U N N E R</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
  body {
    margin: 0;
    overflow: hidden;
    font-family: 'Share Tech Mono', monospace;
    background: black;
    color: white;
  }
  canvas {
    display: block;
    background: black;
  }
  #hud {
    position: absolute;
    top: 10px;
    left: 10px;
    color: white;
    font-size: 20px;
    text-shadow: 2px 2px 4px black;
    font-family: 'Share Tech Mono', monospace;
  }
  #centerMsg {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    color: white;
    font-size: 30px;
    text-shadow: 2px 2px 8px black;
    font-family: 'Share Tech Mono', monospace;
  }
  button {
    font-size: 20px;
    padding: 10px 20px;
    margin-top: 20px;
    font-family: 'Share Tech Mono', monospace;
  }
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="hud"></div>
<div id="centerMsg">
  <h1>L I G H T R U N N E R</h1>
  <button id="startBtn">Start Match</button>
</div>
<script>
const DPR = window.devicePixelRatio || 1;
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const hud = document.getElementById("hud");
const centerMsg = document.getElementById("centerMsg");
const startBtn = document.getElementById("startBtn");

let WIDTH, HEIGHT;
function resize() {
  WIDTH = window.innerWidth;
  HEIGHT = window.innerHeight;
  canvas.width = WIDTH * DPR;
  canvas.height = HEIGHT * DPR;
  canvas.style.width = WIDTH + "px";
  canvas.style.height = HEIGHT + "px";
  ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
}
window.addEventListener("resize", resize);
resize();

let keys = {};
window.addEventListener("keydown", e => { keys[e.key] = true; });
window.addEventListener("keyup", e => { keys[e.key] = false; });

let touchX = null;
let touchY = null;
canvas.addEventListener("touchstart", e => {
  if (!running) return;
  const touch = e.touches[0];
  touchX = touch.clientX;
  touchY = touch.clientY;
  e.preventDefault();
});
canvas.addEventListener("touchmove", e => {
  if (!running) return;
  const touch = e.touches[0];
  const dx = touch.clientX - touchX;
  const dy = touch.clientY - touchY;
  player.x += dx;
  player.y += dy;
  touchX = touch.clientX;
  touchY = touch.clientY;
  e.preventDefault();
});
canvas.addEventListener("touchend", e => {
  touchX = null;
  touchY = null;
  e.preventDefault();
});

function rand(n) { return Math.random() * n; }
function randBetween(a,b) { return a + Math.random()*(b-a); }
function choose(arr) { return arr[Math.floor(Math.random()*arr.length)]; }

const COLORS = ["cyan","magenta","yellow","lime","orange","white","red"];
const ENEMY_COLORS = ["red","orange","magenta"];
const SHOT_COLORS = ["white","cyan","yellow"];

class Entity {
  constructor(x,y,r,color) {
    this.x = x;
    this.y = y;
    this.r = r;
    this.color = color;
  }
  draw() {
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.r,0,Math.PI*2);
    ctx.fill();
  }
}

class Player extends Entity {
  constructor(x,y) {
    super(x,y,15,"cyan");
    this.vx=0; this.vy=0;
    this.speed=4;
    this.score=0;
    this.ammo=3;
  }
  update() {
    if(keys["ArrowUp"]||keys["w"]) this.vy=-this.speed;
    else if(keys["ArrowDown"]||keys["s"]) this.vy=this.speed;
    else this.vy=0;
    if(keys["ArrowLeft"]||keys["a"]) this.vx=-this.speed;
    else if(keys["ArrowRight"]||keys["d"]) this.vx=this.speed;
    else this.vx=0;
    this.x+=this.vx;
    this.y+=this.vy;
    this.x=Math.max(this.r,Math.min(WIDTH-this.r,this.x));
    this.y=Math.max(this.r,Math.min(HEIGHT-this.r,this.y));
    if((keys[" "]||keys["Spacebar"]) && this.ammo>0) {
      shoot();
      this.ammo--;
      keys[" "]=false;
      keys["Spacebar"]=false;
    }
  }
}

class Enemy extends Entity {
  constructor(x,y) {
    super(x,y,15,choose(ENEMY_COLORS));
    this.speed=randBetween(1,2);
    this.angle=rand(Math.PI*2);
  }
  update() {
    this.x+=Math.cos(this.angle)*this.speed;
    this.y+=Math.sin(this.angle)*this.speed;
    if(this.x<this.r||this.x>WIDTH-this.r) this.angle=Math.PI-this.angle;
    if(this.y<this.r||this.y>HEIGHT-this.r) this.angle=-this.angle;
  }
}

class Shot extends Entity {
  constructor(x,y,angle) {
    super(x,y,5,choose(SHOT_COLORS));
    this.vx=Math.cos(angle)*6;
    this.vy=Math.sin(angle)*6;
  }
  update() { this.x+=this.vx; this.y+=this.vy; }
}

class Pickup extends Entity {
  constructor(x,y,type) {
    super(x,y,10,type==="ammo"?"yellow":"lime");
    this.type=type;
  }
}

let player=null;
let enemies=[];
let shots=[];
let pickups=[];
let running=false;
let lastSpawn=0;

// --- START GAME FUNCTION (NEW) ---
function startGame(name="Runner", color=choose(COLORS)) {
  centerMsg.style.display="none";
  spawnWorld(name, color);
}

function spawnWorld(name,color) {
  player=new Player(WIDTH/2,HEIGHT/2);
  player.color=color;
  enemies=[];
  shots=[];
  pickups=[];
  running=true;
  lastSpawn=0;
  loop(0);
}

function shoot() {
  const angle=Math.atan2(0,-1);
  shots.push(new Shot(player.x,player.y-20,angle));
}

function loop(ts) {
  if(!running) return;
  ctx.fillStyle="black";
  ctx.fillRect(0,0,WIDTH,HEIGHT);
  if(ts-lastSpawn>2000) {
    enemies.push(new Enemy(rand(WIDTH),rand(HEIGHT)));
    lastSpawn=ts;
  }
  for(let e of enemies) e.update();
  for(let s of shots) s.update();
  for(let p of pickups) {
    // pickups float
  }
  player.update();
  shots=shots.filter(s=>s.x>-20&&s.x<WIDTH+20&&s.y>-20&&s.y<HEIGHT+20);
  for(let s of shots) {
    for(let i=enemies.length-1;i>=0;i--) {
      const e=enemies[i];
      if(Math.hypot(e.x-s.x,e.y-s.y)<e.r+s.r) {
        enemies.splice(i,1);
        player.score+=10;
        pickups.push(new Pickup(e.x,e.y,Math.random()<0.5?"ammo":"score"));
      }
    }
  }
  for(let i=pickups.length-1;i>=0;i--) {
    const p=pickups[i];
    if(Math.hypot(p.x-player.x,p.y-player.y)<p.r+player.r) {
      if(p.type==="ammo") player.ammo+=3;
      else player.score+=5;
      pickups.splice(i,1);
    }
  }
  for(let e of enemies) {
    if(Math.hypot(e.x-player.x,e.y-player.y)<e.r+player.r) {
      gameOver();
      return;
    }
  }
  for(let e of enemies) e.draw();
  for(let s of shots) s.draw();
  for(let p of pickups) p.draw();
  player.draw();
  hud.innerText=`Score: ${player.score} Ammo: ${player.ammo}`;
  requestAnimationFrame(loop);
}

function gameOver() {
  running=false;
  centerMsg.style.display="block";
  centerMsg.innerHTML=`<h1>Game Over</h1><p>Score: ${player.score}</p><button id="restartBtn">Restart</button>`;
  document.getElementById("restartBtn").onclick=()=>startGame();
}

startBtn.addEventListener("click",()=>startGame());

window.addEventListener("keydown",e=>{
  if(e.key==="r"||e.key==="R") startGame();
});
</script>
</body>
</html>